{"README.md":"","custom.ts":"\n/**\n * Use this file to define custom functions and blocks.\n * Read more at https://makecode.microbit.org/blocks/custom\n */\n\n// This code is currently for internal use only, \n// not to be shared or published without written agreement with Henning Pedersen\n\n\n\nenum PingUnit {\n    //% block=\"Î¼s\"\n    MicroSeconds,\n    //% block=\"cm\"\n    Centimeters,\n    //% block=\"inches\"\n    Inches\n}\n\n/**\n * makecode BMP280 digital pressure sensor Package.\n * From microbit/micropython Chinese community.\n * http://www.micropython.org.cn sdgfds\n */\n\n\n\n/**\n * Custom blocks\n */\n\n//\"\\uf072\"\n//\n\n//% weight=50 color=#0040ff icon=\"\\uf0b2\"\nnamespace AirBit {\n    /**\n     * Set of code blocks for the Drone\n     */\n\n\n    //% block\n    export function getBatteryVoltage(): number {\n        let telemetriBuffer = pins.createBuffer(24)\n\n        /**\n         * \n         * Get the battery voltage from flight controller (telemetry data) \n         * \n         */\n        let BattVoltage = 0\n        telemetriBuffer = serial.readBuffer(10)\n        for (let index = 0; index <= 10; index++) {\n            if (telemetriBuffer[index] == 83) {\n                BattVoltage = telemetriBuffer[index + 2] * 256 + telemetriBuffer[index + 1]\n            }\n        }\n        return BattVoltage\n    }\n\n\n    //% block\n    export function echoStart(trig: DigitalPin): number {\n        /** \n         * Send an echo signal to the Sonar, use echoGetCm to read the result\n         */\n\n        // send pulse\n        pins.setPull(trig, PinPullMode.PullNone);\n        pins.digitalWritePin(trig, 0);\n        control.waitMicros(2);\n        pins.digitalWritePin(trig, 1);\n        control.waitMicros(10);\n        pins.digitalWritePin(trig, 0);\n        return input.runningTimeMicros()\n    }\n\n\n    //% block\n    export function echoGetCm(eTime: number, unit: PingUnit): number {\n        /**\n         * We recommend to run this block in an OnPulsed (interrupt) command.\n         */\n        let eDist = (input.runningTimeMicros() - eTime)\n        //    return (input.runningTimeMicros() / 58)\n        switch (unit) {\n            case PingUnit.Centimeters: return eDist / 58;\n            case PingUnit.Inches: return eDist / 148;\n            default: return eDist;\n        }\n    }\n\n\n\n\n\n    //% block\n    export function blinkXLine(x1: number, x2: number, y: number, speed: number): void {\n        /**\n         * Draw a blinking line along an X axis with speed 0-7\n         */\n        if (((input.runningTime() >> (12 - speed) & 1)) == 1) {\n            for (let x = x1; x <= x2; x++) {\n                led.plot(x, y)\n            }\n        }\n    }\n\n    //% block\n    export function blinkYLine(y1: number, y2: number, x: number, speed: number): void {\n        /**\n         * Draw a blinking line along the Y axis with speed 0-7\n         */\n        if (((input.runningTime() >> (12 - speed) & 1)) == 1) {\n            for (let y = y1; y <= y2; y++) {\n                led.plot(x, y)\n            }\n        }\n    }\n\n    //% block\n    export function plotYLine(y1: number, y2: number, x: number): void {\n        /**\n         * Draw a line along the Y axis. y1: first pixel, y2: last pixel\n         */\n\n        if (y1 >= y2) {\n            for (let y = y2; y <= y1; y++) {\n                led.plot(x, y)\n            }\n        }\n        else if (y1 < y2) {\n            for (let y = y1; y <= y2; y++) {\n                led.plot(x, y)\n            }\n        }\n    }\n\n\n    //% block\n    export function plotXLine(x1: number, x2: number, y: number): void {\n        /**\n        * Draw a line along the X axis\n        */\n        if (x1 >= x2) {\n            for (let x = x2; x <= x1; x++) {\n                led.plot(x, y)\n            }\n        }\n        else if (x1 < x2) {\n            for (let x = x1; x <= x2; x++) {\n                led.plot(x, y)\n            }\n        }\n    }\n\n\n\n\n\n\n\n    //% block\n    export function blinkLed(x: number, y: number, speed: number): void {\n        /**\n         * Plot a blinking led at x,y with speed 0-7\n         */\n        if (((input.runningTime() >> (12 - speed) & 1)) == 1) {\n            led.plot(x, y)\n        }\n\n    }\n\n    //%block\n    export function rotateDotCw(speed: number): void {\n        /**\n         * Draw a dot that is rotating in a clockwise manner with chosen speed\n         */\n        let posisjon = (input.runningTime() >> (12 - speed)) & 15\n        posisjon = pins.map(\n            posisjon,\n            0,\n            15,\n            1,\n            12\n        )\n        if (posisjon == 1) {\n            led.plot(1, 0)\n        }\n        if (posisjon == 2) {\n            led.plot(2, 0)\n        }\n        if (posisjon == 3) {\n            led.plot(3, 0)\n        }\n        if (posisjon == 4) {\n            led.plot(4, 1)\n        }\n        if (posisjon == 5) {\n            led.plot(4, 2)\n        }\n        if (posisjon == 6) {\n            led.plot(4, 3)\n        }\n        if (posisjon == 7) {\n            led.plot(3, 4)\n        }\n        if (posisjon == 8) {\n            led.plot(2, 4)\n        }\n        if (posisjon == 9) {\n            led.plot(1, 4)\n        }\n        if (posisjon == 10) {\n            led.plot(0, 3)\n        }\n        if (posisjon == 11) {\n            led.plot(0, 2)\n        }\n        if (posisjon == 12) {\n            led.plot(0, 1)\n        }\n        // Add code here\n    }\n\n\n    //% block=\"flightcontrol|Throttle $Throttle|Yaw $Yaw|Pitch $Pitch|Roll $Roll|Arm $Arm|Servo 1 $Aux1|Servo 2 $Aux2\"\n    export function FlightControl(Throttle: number, Yaw: number, Pitch: number, Roll: number, Arm: number, Aux1: number, Aux2: number): void {\n        /**\n         * Control TYPR12 (Throttle, Yaw, Pitch, Roll and AUX1 and AUX2) using the Spektsat 2048 protocol\n         * Throttle min: 0, max: 100\n         * Yaw, Pitch Roll: min -90, max 90\n         * Arm: 0 = Disarm, 1 = Arm \n         * Aux1: 0 - 180\n         * Aux2: 0 - 180\n         */\n        let buf = pins.createBuffer(16)\n        let scaling = 1023 / 180\n        let offset = 512\n        // Header \"Fade\" (Spektsat code)\n        buf[0] = 0\n        // Header \"System\" (Spektsat code)  \n        buf[1] = 0x01\n        // 0x01 22MS 1024 DSM2 \n        // 0x12 11MS 2048 DSM2\n        // 0xa2 22MS 2048 DSMS \n        // 0xb2 11MS 2048 DSMX\n\n        // Reverse the pitch \n        Pitch = - Pitch\n\n        // Upscale Arm (Arm = true or false)\n        let armS = 0\n        if (Arm == 0) {\n            armS = 0\n        }\n\n        if (Arm == 1) {\n            armS = 180 * scaling\n        }\n\n        // Aux  limit\n        if (Aux1 > 180) {\n            Aux1 = 180\n        }\n        if (Aux1 < 0) {\n            Aux1 = 0\n        }\n\n        if (Aux2 > 180) {\n            Aux2 = 180\n        }\n        if (Aux2 < 0) {\n            Aux2 = 0\n        }\n\n        if (Throttle > 99) {\n            Throttle = 99\n        }\n        if (Throttle < 0) {\n            Throttle = 0\n        }\n        if (Yaw > 90) {\n            Yaw = 90\n        }\n        if (Yaw < -90) {\n            Yaw = -90\n        }\n        if (Pitch > 90) {\n            Pitch = 90\n        }\n        if (Pitch < -90) {\n            Pitch = -90\n        }\n        if (Roll > 90) {\n            Roll = 90\n        }\n        if (Roll < -90) {\n            Roll = -90\n        }\n\n        let pitchS = Pitch * scaling + offset\n        let rollS = Roll * scaling + offset\n        let yawS = Yaw * scaling + offset\n        let throttleS = (Throttle * 512) / 50\n        let aux1S = Aux1 * scaling\n        let aux2S = Aux2 * scaling\n\n        buf[2] = (0 << 2) | ((rollS >> 8) & 3)\n        buf[3] = rollS & 255\n        buf[4] = (1 << 2) | ((pitchS >> 8) & 3)\n        buf[5] = pitchS & 255\n        buf[6] = (2 << 2) | ((throttleS >> 8) & 3)\n        buf[7] = throttleS & 255\n        buf[8] = (3 << 2) | ((yawS >> 8) & 3)\n        buf[9] = yawS & 255\n        buf[10] = (4 << 2) | ((armS >> 8) & 3)\n        buf[11] = armS & 255\n        buf[12] = (5 << 2) | ((aux1S >> 8) & 3)\n        buf[13] = aux1S & 255\n        buf[14] = (6 << 2) | ((aux2S >> 8) & 3)\n        buf[15] = aux2S & 255\n        serial.writeBuffer(buf)\n\n\n    }\n\n}\n\n\n\n\n\n","main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"$(iM;a(;/N^=e#5%xk.E\">failSafeCounter</variable><variable id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</variable><variable id=\"G/o*%IhR;H$FMgr{~@F4\">yaw</variable><variable id=\";{Ja?3IoC2n9[I=;SNkS\">pitch</variable><variable id=\"bWdJM(.5=VkprPUb+wCj\">roll</variable><variable id=\"Q2Czvk`?L7_VmOWd|Qlz\">arm</variable><variable id=\"$DzScW(%6bLWM^eW9RJ%\">batteryEmpty</variable><variable id=\"3y.DisM5Gr;Wqs8jmP%/\">batteryMilliVolt</variable><variable id=\"*%OT?+lG?lH`.mL~VB|7\">lowBatteryLimit</variable><variable id=\"jgi?mi-vRwLqE:Fyq1S3\">name</variable><variable id=\"92$j%:Kgb{Il^KVM7`;,\">value</variable><variable id=\"3]r@0sxidae]fq;^x-D`\">autoPilot</variable><variable id=\"=+AdHDrLC[rG{s37`70Q\">batteryFactor</variable><variable id=\"gftR+~?XwpE;fS{$VHR@\">buzzer</variable><variable id=\"B1;j;lCfzRk]1oGLkFw9\">radioGroup</variable></variables><block type=\"device_button_event\" x=\"1673\" y=\"-216\"><field name=\"NAME\">Button.AB</field><statement name=\"HANDLER\"><block type=\"controls_if\"><mutation else=\"1\"/><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Q2Czvk`?L7_VmOWd|Qlz\">arm</field></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Q2Czvk`?L7_VmOWd|Qlz\">arm</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Q2Czvk`?L7_VmOWd|Qlz\">arm</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$(iM;a(;/N^=e#5%xk.E\">failSafeCounter</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"/></value></block></next></block></next></block></statement></block><block type=\"bluetooth_on_connected\" x=\"140\" y=\"149\"/><block type=\"control_on_event\" x=\"479\" y=\"201\"><value name=\"src\"><shadow type=\"control_event_source_id\"><field name=\"id\">EventBusSource.MES_DPAD_CONTROLLER_ID</field></shadow></value><value name=\"value\"><shadow type=\"control_event_value_id\"><field name=\"id\">EventBusValue.MICROBIT_EVT_ANY</field></shadow></value><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\";{Ja?3IoC2n9[I=;SNkS\">pitch</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"bWdJM(.5=VkprPUb+wCj\">roll</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"G/o*%IhR;H$FMgr{~@F4\">yaw</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$(iM;a(;/N^=e#5%xk.E\">failSafeCounter</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"/></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value&quot;\"/></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value_id\"><field name=\"id\">EventBusValue.MES_DPAD_BUTTON_1_DOWN</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\";{Ja?3IoC2n9[I=;SNkS\">pitch</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-15</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value&quot;\"/></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value_id\"><field name=\"id\">EventBusValue.MES_DPAD_BUTTON_2_DOWN</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\";{Ja?3IoC2n9[I=;SNkS\">pitch</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">15</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value&quot;\"/></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value_id\"><field name=\"id\">EventBusValue.MES_DPAD_BUTTON_3_DOWN</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"bWdJM(.5=VkprPUb+wCj\">roll</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-15</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value&quot;\"/></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value_id\"><field name=\"id\">EventBusValue.MES_DPAD_BUTTON_4_DOWN</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"bWdJM(.5=VkprPUb+wCj\">roll</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">15</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value&quot;\"/></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value_id\"><field name=\"id\">EventBusValue.MES_DPAD_BUTTON_A_DOWN</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><mutation else=\"1\"/><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">45</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_change\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">5</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"variables_change\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">99</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">99</field></shadow></value></block></statement></block></next></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value&quot;\"/></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value_id\"><field name=\"id\">EventBusValue.MES_DPAD_BUTTON_B_DOWN</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><mutation else=\"1\"/><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">45</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_change\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-5</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"variables_change\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-1</field></shadow></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement></block></next></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value&quot;\"/></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value_id\"><field name=\"id\">EventBusValue.MES_DPAD_BUTTON_C_DOWN</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"G/o*%IhR;H$FMgr{~@F4\">yaw</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">-15</field></shadow></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Q2Czvk`?L7_VmOWd|Qlz\">arm</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement></block></next></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value&quot;\"/></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"control_event_value_id\"><field name=\"id\">EventBusValue.MES_DPAD_BUTTON_D_DOWN</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"G/o*%IhR;H$FMgr{~@F4\">yaw</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">15</field></shadow></value><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Q2Czvk`?L7_VmOWd|Qlz\">arm</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></statement></block></next></block></statement></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"device_forever\" x=\"1237\" y=\"201\"><statement name=\"HANDLER\"><block type=\"function_call\"><mutation name=\"calculateBatteryVoltage\" functionid=\"2fQsq11zMEN-9aYMCg+(\"/><next><block type=\"device_led_toggle\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" label=\"Number\" precision=\"0\"/><field name=\"SLIDER\">4</field></shadow></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" label=\"Number\" precision=\"0\"/><field name=\"SLIDER\">0</field></shadow></value><next><block type=\"controls_if\"><mutation elseif=\"1\" else=\"1\"/><comment pinned=\"false\" h=\"80\" w=\"160\">basic.clearScreen()</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_analog_pin\"><field name=\"name\">AnalogPin.P0</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">600</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_analog_pin\"><field name=\"name\">AnalogPin.P0</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">400</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"iconBatteryCharging\" functionid=\"Yj}?,I,:7zQ9]+d]b_=2\"/></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$DzScW(%6bLWM^eW9RJ%\">batteryEmpty</field></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"3y.DisM5Gr;Wqs8jmP%/\">batteryMilliVolt</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*%OT?+lG?lH`.mL~VB|7\">lowBatteryLimit</field></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_analog_pin\"><field name=\"name\">AnalogPin.P0</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">300</field></shadow></value></block></value></block></value></block></value><statement name=\"DO1\"><block type=\"function_call\"><mutation name=\"lowBattery\" functionid=\"ak[9U}U!R(Wx]WTRr]UK\"/></block></statement><statement name=\"ELSE\"><block type=\"function_call\"><mutation name=\"mainScreen\" functionid=\"PNplcf!MSNn92VFaWc|4\"/><next><block type=\"variables_set\"><field name=\"VAR\" id=\"gftR+~?XwpE;fS{$VHR@\">buzzer</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></next></block></statement><next><block type=\"controls_if\"><comment pinned=\"false\" h=\"80\" w=\"160\">failSafe()</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$DzScW(%6bLWM^eW9RJ%\">batteryEmpty</field></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Q2Czvk`?L7_VmOWd|Qlz\">arm</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement><next><block type=\"function_call\"><mutation name=\"failSafe\" functionid=\"z1Ssy~3#BczLmjc`oa^d\"/><next><block type=\"AirBit_FlightControl\"><value name=\"Throttle\"><block type=\"variables_get\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field></block></value><value name=\"Yaw\"><block type=\"variables_get\"><field name=\"VAR\" id=\"G/o*%IhR;H$FMgr{~@F4\">yaw</field></block></value><value name=\"Pitch\"><block type=\"variables_get\"><field name=\"VAR\" id=\";{Ja?3IoC2n9[I=;SNkS\">pitch</field></block></value><value name=\"Roll\"><block type=\"variables_get\"><field name=\"VAR\" id=\"bWdJM(.5=VkprPUb+wCj\">roll</field></block></value><value name=\"Arm\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Q2Czvk`?L7_VmOWd|Qlz\">arm</field></block></value><value name=\"Aux1\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"Aux2\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"2772\" y=\"201\"><mutation name=\"iconBatteryLow\" functionid=\"9r.#7q8M:A5^{Fe|qJg3\"/><field name=\"function_name\">iconBatteryLow</field><statement name=\"STACK\"><block type=\"typescript_statement\" editable=\"false\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"basic.showLeds(`\" line1=\"            . . # . .\" line2=\"            . # # # .\" line3=\"            . # . # .\" line4=\"            . # . # .\" line5=\"            . # # # .\" line6=\"            `, 0)\" numlines=\"7\"></mutation></block></statement></block><block type=\"pxt-on-start\" x=\"26\" y=\"379\"><statement name=\"HANDLER\"><block type=\"bluetooth_start_accelerometer_service\"><next><block type=\"variables_set\"><field name=\"VAR\" id=\"=+AdHDrLC[rG{s37`70Q\">batteryFactor</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">4.42</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"*%OT?+lG?lH`.mL~VB|7\">lowBatteryLimit</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">3400</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"3y.DisM5Gr;Wqs8jmP%/\">batteryMilliVolt</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">3700</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$DzScW(%6bLWM^eW9RJ%\">batteryEmpty</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"serial_redirect\"><field name=\"tx\">SerialPin.P1</field><field name=\"rx\">SerialPin.P2</field><field name=\"rate\">BaudRate.BaudRate115200</field><next><block type=\"device_print_message\"><value name=\"text\"><shadow type=\"text\"><field name=\"TEXT\">C</field></shadow></value><next><block type=\"controls_repeat_ext\"><value name=\"TIMES\"><shadow type=\"math_whole_number\"><field name=\"NUM\">20</field></shadow></value><statement name=\"DO\"><block type=\"AirBit_FlightControl\"><value name=\"Throttle\"><shadow type=\"math_number\"><field name=\"NUM\">99</field></shadow></value><value name=\"Yaw\"><shadow type=\"math_number\"><field name=\"NUM\">-90</field></shadow></value><value name=\"Pitch\"><shadow type=\"math_number\"><field name=\"NUM\">90</field></shadow></value><value name=\"Roll\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"Arm\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"Aux1\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"Aux2\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">20</field></shadow></value></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">2000</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"2011\" y=\"811\"><mutation name=\"mainScreen\" functionid=\"PNplcf!MSNn92VFaWc|4\"/><field name=\"function_name\">mainScreen</field><statement name=\"STACK\"><block type=\"device_clear_display\"><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Q2Czvk`?L7_VmOWd|Qlz\">arm</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_modulo\"><value name=\"DIVIDEND\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"/></value><value name=\"DIVISOR\"><shadow type=\"math_number\"><field name=\"NUM\">500</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">250</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"device_plot\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" label=\"Number\" precision=\"0\"/><field name=\"SLIDER\">0</field></shadow></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" label=\"Number\" precision=\"0\"/><field name=\"SLIDER\">0</field></shadow></value></block></statement></block></statement><next><block type=\"device_plot\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" label=\"Number\" precision=\"0\"/><field name=\"SLIDER\">0</field></shadow></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\"/><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">99</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">20</field></shadow></value></block></value><next><block type=\"device_plot\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\"/><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">45</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"bWdJM(.5=VkprPUb+wCj\">roll</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">18</field></shadow></value></block></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\"/><field name=\"SLIDER\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">45</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";{Ja?3IoC2n9[I=;SNkS\">pitch</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">18</field></shadow></value></block></value><next><block type=\"device_plot\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\"/><field name=\"SLIDER\">0</field></shadow><block type=\"math_map\"><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"G/o*%IhR;H$FMgr{~@F4\">yaw</field></block></value><value name=\"fromLow\"><shadow type=\"math_number\"><field name=\"NUM\">-15</field></shadow></value><value name=\"fromHigh\"><shadow type=\"math_number\"><field name=\"NUM\">15</field></shadow></value><value name=\"toLow\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><value name=\"toHigh\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></block></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" label=\"Number\" precision=\"0\"/><field name=\"SLIDER\">4</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"/><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"3y.DisM5Gr;Wqs8jmP%/\">batteryMilliVolt</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">100</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><mutation else=\"1\"/><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"Q2Czvk`?L7_VmOWd|Qlz\">arm</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"AirBit_plotYLine\"><value name=\"y1\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"y2\"><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_map\"><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"3y.DisM5Gr;Wqs8jmP%/\">batteryMilliVolt</field></block></value><value name=\"fromLow\"><shadow type=\"math_number\"><field name=\"NUM\">3400</field></shadow></value><value name=\"fromHigh\"><shadow type=\"math_number\"><field name=\"NUM\">3900</field></shadow></value><value name=\"toLow\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"toHigh\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value></block></value><value name=\"x\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"AirBit_plotYLine\"><value name=\"y1\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"y2\"><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_map\"><value name=\"value\"><block type=\"variables_get\"><field name=\"VAR\" id=\"3y.DisM5Gr;Wqs8jmP%/\">batteryMilliVolt</field></block></value><value name=\"fromLow\"><shadow type=\"math_number\"><field name=\"NUM\">3700</field></shadow></value><value name=\"fromHigh\"><shadow type=\"math_number\"><field name=\"NUM\">4200</field></shadow></value><value name=\"toLow\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value><value name=\"toHigh\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value></block></value><value name=\"x\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value></block></statement></block></statement><statement name=\"ELSE\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_modulo\"><value name=\"DIVIDEND\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"/></value><value name=\"DIVISOR\"><shadow type=\"math_number\"><field name=\"NUM\">500</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">250</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"device_plot\"><value name=\"x\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" label=\"Number\" precision=\"0\"/><field name=\"SLIDER\">4</field></shadow></value><value name=\"y\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" label=\"Number\" precision=\"0\"/><field name=\"SLIDER\">4</field></shadow></value></block></statement></block></statement></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"math_number\" disabled=\"true\" x=\"1400\" y=\"981\"><field name=\"NUM\">0</field></block><block type=\"device_gesture_event\" x=\"1622\" y=\"1289\"><field name=\"NAME\">Gesture.ScreenDown</field><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Q2Czvk`?L7_VmOWd|Qlz\">arm</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></statement></block><block type=\"function_definition\" x=\"1361\" y=\"1486\"><mutation name=\"calculateBatteryVoltage\" functionid=\"2fQsq11zMEN-9aYMCg+(\"/><field name=\"function_name\">calculateBatteryVoltage</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"3y.DisM5Gr;Wqs8jmP%/\">batteryMilliVolt</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_analog_pin\"><field name=\"name\">AnalogPin.P0</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"=+AdHDrLC[rG{s37`70Q\">batteryFactor</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0.05</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"3y.DisM5Gr;Wqs8jmP%/\">batteryMilliVolt</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0.95</field></shadow></value></block></value></block></value></block></value></block></statement></block><block type=\"function_definition\" x=\"1171\" y=\"1654\"><mutation name=\"failSafe\" functionid=\"z1Ssy~3#BczLmjc`oa^d\"/><field name=\"function_name\">failSafe</field><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"/></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$(iM;a(;/N^=e#5%xk.E\">failSafeCounter</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">3000</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">30</field></shadow><block type=\"math_constrain_value\"><value name=\"value\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field></block></value><value name=\"low\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"high\"><shadow type=\"math_number\"><field name=\"NUM\">30</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"G/o*%IhR;H$FMgr{~@F4\">yaw</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\";{Ja?3IoC2n9[I=;SNkS\">pitch</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"bWdJM(.5=VkprPUb+wCj\">roll</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></next></block></next></block></next></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"/></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$(iM;a(;/N^=e#5%xk.E\">failSafeCounter</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">5000</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Q2Czvk`?L7_VmOWd|Qlz\">arm</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></next></block></statement></block></next></block></statement></block><block type=\"function_definition\" x=\"838\" y=\"2310\"><mutation name=\"iconBatteryCharging\" functionid=\"Yj}?,I,:7zQ9]+d]b_=2\"/><field name=\"function_name\">iconBatteryCharging</field><statement name=\"STACK\"><block type=\"device_show_leds\"><field name=\"LEDS\">`&#10;        . . # . . &#10;        . # . # . &#10;        . # . # . &#10;        . # . # . &#10;        . # # # .&#10;        `</field><next><block type=\"device_show_leds\"><field name=\"LEDS\">`&#10;        . . # . . &#10;        . # . # . &#10;        . # . # . &#10;        . # # # . &#10;        . # # # .&#10;        `</field><next><block type=\"device_show_leds\"><field name=\"LEDS\">`&#10;        . . # . . &#10;        . # . # . &#10;        . # # # . &#10;        . # # # . &#10;        . # # # .&#10;        `</field><next><block type=\"device_show_leds\"><field name=\"LEDS\">`&#10;        . . # . . &#10;        . # # # . &#10;        . # # # . &#10;        . # # # . &#10;        . # # # .&#10;        `</field></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"2095\" y=\"2310\"><mutation name=\"lowBattery\" functionid=\"ak[9U}U!R(Wx]WTRr]UK\"/><field name=\"function_name\">lowBattery</field><statement name=\"STACK\"><block type=\"controls_if\"><mutation elseif=\"2\" else=\"1\"/><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"$DzScW(%6bLWM^eW9RJ%\">batteryEmpty</field></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"iconBatteryDead\" functionid=\"MGr,{FD6a4LZNbbfEY}z\"/></block></statement><value name=\"IF1\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"3y.DisM5Gr;Wqs8jmP%/\">batteryMilliVolt</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*%OT?+lG?lH`.mL~VB|7\">lowBatteryLimit</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">50</field></shadow></value></block></value></block></value><statement name=\"DO1\"><block type=\"function_call\"><mutation name=\"iconBatteryLow\" functionid=\"9r.#7q8M:A5^{Fe|qJg3\"/></block></statement><value name=\"IF2\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"3y.DisM5Gr;Wqs8jmP%/\">batteryMilliVolt</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"*%OT?+lG?lH`.mL~VB|7\">lowBatteryLimit</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">60</field></shadow></value></block></value></block></value><statement name=\"DO2\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_modulo\"><value name=\"DIVIDEND\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"device_get_running_time\"/></value><value name=\"DIVISOR\"><shadow type=\"math_number\"><field name=\"NUM\">1000</field></shadow></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">500</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"function_call\"><mutation name=\"iconBatteryLow\" functionid=\"9r.#7q8M:A5^{Fe|qJg3\"/></block></statement></block></statement><statement name=\"ELSE\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Q2Czvk`?L7_VmOWd|Qlz\">arm</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"ZIxBiY++w3iyT!!+R`_x\">throttle</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"$DzScW(%6bLWM^eW9RJ%\">batteryEmpty</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><next><block type=\"function_call\"><mutation name=\"iconBatteryDead\" functionid=\"MGr,{FD6a4LZNbbfEY}z\"/></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"function_definition\" x=\"2992\" y=\"2310\"><mutation name=\"iconBatteryDead\" functionid=\"MGr,{FD6a4LZNbbfEY}z\"/><field name=\"function_name\">iconBatteryDead</field><statement name=\"STACK\"><block type=\"device_show_leds\"><field name=\"LEDS\">`&#10;        . # # # . &#10;        # . # . # &#10;        # # # # # &#10;        . # . # . &#10;        . # . # .&#10;        `</field></block></statement></block></xml>","main.ts":"function failSafe () {\n    if (input.runningTime() > failSafeCounter + 3000) {\n        throttle = Math.constrain(throttle, 0, 30)\n        yaw = 0\n        pitch = 0\n        roll = 0\n    }\n    if (input.runningTime() > failSafeCounter + 5000) {\n        arm = 0\n        throttle = 0\n    }\n}\nfunction lowBattery () {\n    if (batteryEmpty) {\n        iconBatteryDead()\n    } else if (batteryMilliVolt > lowBatteryLimit - 50) {\n        iconBatteryLow()\n    } else if (batteryMilliVolt > lowBatteryLimit - 60) {\n        if (input.runningTime() % 1000 < 500) {\n            iconBatteryLow()\n        }\n    } else {\n        arm = 0\n        throttle = 0\n        batteryEmpty = true\n        iconBatteryDead()\n    }\n}\nfunction iconBatteryCharging () {\n    basic.showLeds(`\n        . . # . .\n        . # . # .\n        . # . # .\n        . # . # .\n        . # # # .\n        `)\n    basic.showLeds(`\n        . . # . .\n        . # . # .\n        . # . # .\n        . # # # .\n        . # # # .\n        `)\n    basic.showLeds(`\n        . . # . .\n        . # . # .\n        . # # # .\n        . # # # .\n        . # # # .\n        `)\n    basic.showLeds(`\n        . . # . .\n        . # # # .\n        . # # # .\n        . # # # .\n        . # # # .\n        `)\n}\nfunction mainScreen () {\n    basic.clearScreen()\n    if (arm == 1) {\n        if (input.runningTime() % 500 > 250) {\n            led.plot(0, 0)\n        }\n    }\n    led.plot(0, (99 - throttle) / 20)\n    led.plot((45 + roll) / 18, (45 + pitch) / 18)\n    led.plot(Math.map(yaw, -15, 15, 1, 3), 4)\n    if (batteryMilliVolt > 100) {\n        if (arm == 1) {\n            AirBit.plotYLine(4, Math.round(Math.map(batteryMilliVolt, 3400, 3900, 4, 0)), 4)\n        } else {\n            AirBit.plotYLine(4, Math.round(Math.map(batteryMilliVolt, 3700, 4200, 4, 0)), 4)\n        }\n    } else {\n        if (input.runningTime() % 500 > 250) {\n            led.plot(4, 4)\n        }\n    }\n}\nfunction iconBatteryDead () {\n    basic.showLeds(`\n        . # # # .\n        # . # . #\n        # # # # #\n        . # . # .\n        . # . # .\n        `)\n}\nbluetooth.onBluetoothConnected(function () {\n\t\n})\nfunction calculateBatteryVoltage () {\n    batteryMilliVolt = Math.round(pins.analogReadPin(AnalogPin.P0) * batteryFactor * 0.05 + batteryMilliVolt * 0.95)\n}\nfunction iconBatteryLow () {\n    basic.showLeds(`\n            . . # . .\n            . # # # .\n            . # . # .\n            . # . # .\n            . # # # .\n            `, 0)\n}\ninput.onGesture(Gesture.ScreenDown, function () {\n    arm = 0\n})\ninput.onButtonPressed(Button.AB, function () {\n    if (arm) {\n        arm = 0\n    } else {\n        arm = 1\n    }\n    throttle = 0\n    failSafeCounter = input.runningTime()\n})\ncontrol.onEvent(EventBusSource.MES_DPAD_CONTROLLER_ID, EventBusValue.MICROBIT_EVT_ANY, function () {\n    pitch = 0\n    roll = 0\n    yaw = 0\n    failSafeCounter = input.runningTime()\n    if (control.eventValue() == EventBusValue.MES_DPAD_BUTTON_1_DOWN) {\n        pitch = -15\n    }\n    if (control.eventValue() == EventBusValue.MES_DPAD_BUTTON_2_DOWN) {\n        pitch = 15\n    }\n    if (control.eventValue() == EventBusValue.MES_DPAD_BUTTON_3_DOWN) {\n        roll = -15\n    }\n    if (control.eventValue() == EventBusValue.MES_DPAD_BUTTON_4_DOWN) {\n        roll = 15\n    }\n    if (control.eventValue() == EventBusValue.MES_DPAD_BUTTON_A_DOWN) {\n        if (throttle < 45) {\n            throttle += 5\n        } else {\n            throttle += 1\n        }\n        if (throttle > 99) {\n            throttle = 99\n        }\n    }\n    if (control.eventValue() == EventBusValue.MES_DPAD_BUTTON_B_DOWN) {\n        if (throttle < 45) {\n            throttle += -5\n        } else {\n            throttle += -1\n        }\n        if (throttle < 0) {\n            throttle = 0\n        }\n    }\n    if (control.eventValue() == EventBusValue.MES_DPAD_BUTTON_C_DOWN) {\n        yaw = -15\n        if (throttle == 0) {\n            arm = 0\n        }\n    }\n    if (control.eventValue() == EventBusValue.MES_DPAD_BUTTON_D_DOWN) {\n        yaw = 15\n        if (throttle == 0) {\n            arm = 1\n        }\n    }\n})\nlet buzzer = 0\nlet arm = 0\nlet roll = 0\nlet pitch = 0\nlet yaw = 0\nlet failSafeCounter = 0\nlet batteryEmpty = false\nlet throttle = 0\nlet batteryMilliVolt = 0\nlet lowBatteryLimit = 0\nlet batteryFactor = 0\nbluetooth.startAccelerometerService()\nbatteryFactor = 4.42\nlowBatteryLimit = 3400\nbatteryMilliVolt = 3700\nthrottle = 0\nbatteryEmpty = false\nserial.redirect(\nSerialPin.P1,\nSerialPin.P2,\nBaudRate.BaudRate115200\n)\nbasic.showString(\"C\")\nfor (let index = 0; index < 20; index++) {\n    AirBit.FlightControl(\n    99,\n    -90,\n    90,\n    0,\n    0,\n    0,\n    0\n    )\n    basic.pause(20)\n}\nbasic.pause(2000)\nbasic.forever(function () {\n    calculateBatteryVoltage()\n    led.toggle(4, 0)\n    // basic.clearScreen()\n    if (pins.analogReadPin(AnalogPin.P0) < 600 && pins.analogReadPin(AnalogPin.P0) >= 400) {\n        iconBatteryCharging()\n    } else if (batteryEmpty || batteryMilliVolt < lowBatteryLimit && pins.analogReadPin(AnalogPin.P0) > 300) {\n        lowBattery()\n    } else {\n        mainScreen()\n        buzzer = 0\n    }\n    // failSafe()\n    if (batteryEmpty) {\n        arm = 0\n    }\n    failSafe()\n    AirBit.FlightControl(\n    throttle,\n    yaw,\n    pitch,\n    roll,\n    arm,\n    0,\n    0\n    )\n})\n","pxt.json":"{\n    \"name\": \"Airbit-Drone-iPad 2021\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"microphone\": \"*\",\n        \"bluetooth\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"custom.ts\"\n    ],\n    \"targetVersions\": {\n        \"branch\": \"v1.1.90\",\n        \"tag\": \"v1.1.90\",\n        \"commits\": \"https://github.com/Microsoft/pxt-microbit/commits/c571c91f0ba665843e5ae54b15d6b9bb7c316265\",\n        \"target\": \"1.1.90\",\n        \"pxt\": \"4.1.49\"\n    },\n    \"preferredEditor\": \"blocksprj\"\n}\n"}